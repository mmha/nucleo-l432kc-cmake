CMake for mbed/STM32 Nucleo L432KC
==================================

A gcc Toolchain based on the makefile generated from the mbed web compiler. The most important benefit is that you can use the IDE of your choice (CLion, KDevelop, Code::Blocks, ...) and a C++ standard from this millenium.

This repository also contains a blink/USB communication example and a `Findmbed.cmake`, which is also providing a flash target.

Dependencies
============
- CMake 3.6 (Older versions are very likely to work)
- A gcc toolchain for the `arm-none-eabi` target

Quick start
===========

1. Clone this repository
2. Get a copy of the [mbed sources](https://developer.mbed.org/users/mbed_official/code/mbed/) and place them in a directory called `mbed` in this projects root
3. Create a build directory as usual with CMake projects
4. If not already done, connect your board and mount the virtual mass storage
5. `cmake path/to/root -DCMAKE_TOOLCHAIN_FILE=path/to/root/cmake/nucleo_l432kc_gcc.cmake -DMBED_CONTROLLER_DIR=path/to/nucleo/mountpoint`
6. `make blink_NUCLEO_L432KC_flash`
7. Your code will now compile and get flashed onto your microcontroller

Advanced Usage
==============

Path Customization
------------------
You can pass several options to CMake to set the paths required for compiling:

Option                | Description
----------------------|------------
MBED\_DIR             | *Optional* - Set the root of the mbed sources
MBED\_CONTROLLER\_DIR | *Optional* - Set the directory of the virtual mass storage for comfortable flashing

FIndmbed.cmake
--------------
This defines the `mbed::mbed` target, which shall be linked against to create a firmware.

This also defines the following functions:
```cmake
function(enable_binary_generation target)
```
Adds a post build step to the target, which runs `objcopy` to create a bin from the ELF generated by gcc.


```cmake
function(add_flash_target target)
```
Adds a custom target named `target_flash` which copies the firmware to the virtual mass storage.

**Preconditions**: `enable_binary_generation` has been called on the same target and `MBED_CONTROLLER_DIR` is defined.

